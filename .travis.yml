language: node_js
node_js:
  - "stable"
cache:
  directories:
    - "node_modules"
    - "ci/node_modules"
  yarn: true
before_install:
  - chmod -R +x ci
  - (cd ci && yarn && node status)
after_success:
  - cd ci
  - echo -e "-----BEGIN RSA PRIVATE KEY-----\n${sshkey//'#'/$'\n'}\n-----END RSA PRIVATE KEY-----\n" > sshkey
  - chmod 400 sshkey
  - node status success
  - if [ -z "$sshcmd" ]; then sshcmd="cd \"$sshdir\" && npm run pull"; fi
  - ssh -i sshkey -o "StrictHostKeyChecking no" -t $sshuser@$sshhost "$sshcmd"
after_failure:
  - (cd ci && node status failure)
notifications:
  email:
    on_success: never
    on_failure: never